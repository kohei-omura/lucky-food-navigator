<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ½ï¸ Lucky Food Navigator</title>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700;900&family=M+PLUS+Rounded+1c:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #FF6B6B;
            --secondary: #FFD93D;
            --accent: #6BCF7F;
            --deep: #2C3E50;
            --text: #2C3E50;
            --bg: #FFF8E7;
            --card: #FFFFFF;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'M PLUS Rounded 1c', sans-serif;
            background: linear-gradient(135deg, #FFF8E7 0%, #FFE5B4 100%);
            color: var(--text);
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }
        
        /* èƒŒæ™¯è£…é£¾ */
        .bg-deco {
            position: fixed;
            pointer-events: none;
            z-index: 0;
        }
        .star { 
            position: absolute;
            animation: twinkle 3s infinite;
            font-size: 1.5rem;
            opacity: 0.3;
        }
        @keyframes twinkle {
            0%, 100% { opacity: 0.2; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.2); }
        }
        .food-float {
            position: absolute;
            font-size: 2rem;
            animation: float 15s infinite linear;
            opacity: 0.15;
        }
        @keyframes float {
            0% { transform: translateY(100vh) rotate(0deg); }
            100% { transform: translateY(-100vh) rotate(360deg); }
        }
        
        .container {
            max-width: 480px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            animation: slideDown 0.6s ease-out;
        }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .logo {
            font-size: 3rem;
            margin-bottom: 10px;
            animation: bounce 2s infinite;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        h1 {
            font-family: 'Zen Maru Gothic', sans-serif;
            font-size: 1.8rem;
            font-weight: 900;
            color: var(--primary);
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .subtitle {
            font-size: 0.9rem;
            color: #666;
            font-weight: 700;
        }
        
        .time-display {
            background: var(--card);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
            text-align: center;
            animation: fadeIn 0.8s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .time-label {
            font-size: 0.75rem;
            color: #999;
            margin-bottom: 5px;
            letter-spacing: 0.1em;
        }
        
        .time-value {
            font-size: 1.8rem;
            font-weight: 900;
            color: var(--primary);
            font-family: 'Zen Maru Gothic', sans-serif;
        }
        
        .fortune-btn {
            width: 100%;
            padding: 25px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            border-radius: 25px;
            color: white;
            font-size: 1.5rem;
            font-weight: 900;
            font-family: 'Zen Maru Gothic', sans-serif;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(255,107,107,0.4);
            transition: all 0.3s ease;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .fortune-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .fortune-btn:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .fortune-btn:active {
            transform: scale(0.98);
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }
        .loading.show { display: block; }
        
        .loading-icon {
            font-size: 4rem;
            animation: spin 1s linear infinite;
            display: inline-block;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .loading-text {
            margin-top: 15px;
            font-size: 1rem;
            color: #666;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        
        .result {
            display: none;
        }
        .result.show {
            display: block;
            animation: resultAppear 0.8s ease-out;
        }
        @keyframes resultAppear {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .result-card {
            background: var(--card);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 15px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
            border-left: 5px solid var(--primary);
            transition: all 0.3s ease;
            animation: slideIn 0.6s ease-out;
            animation-fill-mode: both;
        }
        .result-card:nth-child(1) { animation-delay: 0.1s; border-left-color: #FFD700; }
        .result-card:nth-child(2) { animation-delay: 0.2s; border-left-color: #C0C0C0; }
        .result-card:nth-child(3) { animation-delay: 0.3s; border-left-color: #CD7F32; }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .result-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 32px rgba(0,0,0,0.16);
        }
        
        .rank {
            display: inline-block;
            font-size: 2rem;
            margin-right: 10px;
        }
        
        .shop-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .shop-icon {
            font-size: 2.5rem;
            margin-right: 15px;
        }
        
        .shop-info {
            flex: 1;
        }
        
        .shop-name {
            font-size: 1.3rem;
            font-weight: 900;
            color: var(--text);
            margin-bottom: 3px;
        }
        
        .shop-location {
            font-size: 0.8rem;
            color: #999;
        }
        
        .score-badge {
            background: linear-gradient(135deg, var(--accent), #4ECDC4);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 900;
            font-size: 1.1rem;
            display: inline-block;
            margin-bottom: 12px;
            box-shadow: 0 4px 12px rgba(110,207,127,0.3);
        }
        
        .reason {
            background: #FFF8E7;
            padding: 15px;
            border-radius: 12px;
            font-size: 0.9rem;
            line-height: 1.7;
            color: #555;
            margin-bottom: 12px;
        }
        
        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .tag {
            background: var(--secondary);
            color: var(--text);
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 700;
        }
        
        .summary {
            background: var(--card);
            border-radius: 20px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
            text-align: center;
        }
        
        .summary-title {
            font-size: 0.85rem;
            color: #999;
            margin-bottom: 10px;
            letter-spacing: 0.1em;
        }
        
        .summary-text {
            font-size: 1rem;
            line-height: 1.8;
            color: #555;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #999;
            font-size: 0.8rem;
        }
        
        .back-btn {
            width: 100%;
            padding: 15px;
            background: #E0E0E0;
            border: none;
            border-radius: 15px;
            color: #666;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background: #D0D0D0;
        }
    </style>
</head>
<body>
<!-- èƒŒæ™¯è£…é£¾ -->
<div class="bg-deco">
    <div class="star" style="top:10%;left:20%;">âœ¨</div>
    <div class="star" style="top:30%;left:80%;">â­</div>
    <div class="star" style="top:60%;left:15%;">ğŸ’«</div>
    <div class="star" style="top:80%;left:75%;">ğŸŒŸ</div>
    <div class="food-float" style="left:10%;animation-delay:0s;">ğŸœ</div>
    <div class="food-float" style="left:70%;animation-delay:3s;">ğŸ°</div>
    <div class="food-float" style="left:40%;animation-delay:6s;">â˜•</div>
    <div class="food-float" style="left:85%;animation-delay:9s;">ğŸ±</div>
</div>

<div class="container">
    <header>
        <div class="logo">ğŸ”®ğŸ½ï¸</div>
        <h1>Lucky Food Navigator</h1>
        <p class="subtitle">ã‚¤ã‚ªãƒ³ãƒ¢ãƒ¼ãƒ«å®®å´å°‚ç”¨ é–‹é‹ã‚°ãƒ«ãƒ¡ã‚¬ã‚¤ãƒ‰</p>
    </header>
    
    <div class="time-display">
        <div class="time-label">ğŸ“… ä»Šã®æ—¥æ™‚</div>
        <div class="time-value" id="current-time">å–å¾—ä¸­...</div>
    </div>
    
    <button class="fortune-btn" onclick="startFortune()">
        âœ¨ ä»Šã™ãé£Ÿã¹ã‚‹ã¹ãåº—ã‚’å ã† âœ¨
    </button>
    
    <div class="loading" id="loading">
        <div class="loading-icon">ğŸ”®</div>
        <div class="loading-text">æ˜Ÿã€…ã«å•ã„ã‹ã‘ã¦ã„ã¾ã™...</div>
    </div>
    
    <div class="result" id="result"></div>
    
    <footer>
        Powered by ã‚¯ãƒˆã¡ã‚ƒã‚“ ğŸ’«<br>
        æ™ƒå¹³ã•ã‚“å°‚ç”¨ï¼ˆç‰¡ç¾Šåº§ãƒ»Bå‹ãƒ»é…‰å¹´ï¼‰
    </footer>
</div>

<script>
// ========== ã‚¤ã‚ªãƒ³ãƒ¢ãƒ¼ãƒ«å®®å´ å…¨é£²é£Ÿåº—ãƒ‡ãƒ¼ã‚¿ ==========
const restaurants = [
    // 1Fãƒ¬ã‚¹ãƒˆãƒ©ãƒ³è¡—
    { name:'åŒ—æµ·é“ã‚­ãƒƒãƒãƒ³ YOSHIMI', floor:'1F', genre:'ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³', element:'åœŸ', hours:{open:11,close:22}, emoji:'ğŸ´', tags:['ãƒ­ãƒ¼ã‚¹ãƒˆãƒ“ãƒ¼ãƒ•ä¸¼','åŒ—æµ·é“ã‚°ãƒ«ãƒ¡','ãƒ©ãƒ³ãƒ'] },
    { name:'ã‚³ãƒ¡ãƒ€çˆç²åº—', floor:'1F', genre:'ã‚«ãƒ•ã‚§', element:'é¢¨', hours:{open:9,close:22}, emoji:'â˜•', tags:['ãƒ¢ãƒ¼ãƒ‹ãƒ³ã‚°','ã‚«ãƒ•ã‚§','è»½é£Ÿ'] },
    { name:'ç¯‰åœ°é£Ÿå ‚ æºã¡ã‚ƒã‚“', floor:'1F', genre:'æµ·é®®ãƒ»å’Œé£Ÿ', element:'æ°´', hours:{open:11,close:22}, emoji:'ğŸŸ', tags:['æµ·é®®ä¸¼','å’Œé£Ÿ','é¯›ã”ã¾ä¸¼'] },
    { name:'ã¦ã‚“ã·ã‚‰ä¸€ä»£', floor:'1F', genre:'å¤©ã·ã‚‰', element:'ç«', hours:{open:11,close:22}, emoji:'ğŸ¤', tags:['å¤©ã·ã‚‰','æšã’ç‰©','å®šé£Ÿ'] },
    { name:'ã‚¹ã‚¿ãƒ¼ãƒãƒƒã‚¯ã‚¹ï¼ˆ1Fï¼‰', floor:'1F', genre:'ã‚«ãƒ•ã‚§', element:'é¢¨', hours:{open:9,close:22}, emoji:'â˜•', tags:['ã‚«ãƒ•ã‚§','ã‚¹ã‚¿ãƒ','ãƒ•ãƒ©ãƒšãƒãƒ¼ãƒ'] },
    { name:'ã‚¤ã‚¿ãƒªã‚¢ãƒ³ãƒˆãƒãƒˆ', floor:'1F', genre:'ã‚«ãƒ•ã‚§ãƒ»æ´‹é£Ÿ', element:'é¢¨', hours:{open:10,close:22}, emoji:'ğŸ', tags:['ãƒ‘ã‚¹ã‚¿','æ´‹é£Ÿ','ã‚«ãƒ•ã‚§'] },
    { name:'ã‚±ãƒ³ã‚¿ãƒƒã‚­ãƒ¼', floor:'1F', genre:'ãƒ•ã‚¡ã‚¹ãƒˆãƒ•ãƒ¼ãƒ‰', element:'ç«', hours:{open:10,close:22}, emoji:'ğŸ—', tags:['ãƒã‚­ãƒ³','ãƒ•ã‚¡ã‚¹ãƒˆãƒ•ãƒ¼ãƒ‰'] },
    { name:'ãƒã‚¯ãƒ‰ãƒŠãƒ«ãƒ‰', floor:'1F', genre:'ãƒ•ã‚¡ã‚¹ãƒˆãƒ•ãƒ¼ãƒ‰', element:'ç«', hours:{open:7,close:24}, emoji:'ğŸ”', tags:['ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼','24æ™‚é–“å–¶æ¥­'] },
    { name:'éŠ€åº§æƒ£èœåº—', floor:'1F', genre:'æƒ£èœãƒ»ç„¼ãé³¥', element:'ç«', hours:{open:10,close:22}, emoji:'ğŸ—', tags:['ç„¼ãé³¥','æƒ£èœ','ãƒ†ã‚¤ã‚¯ã‚¢ã‚¦ãƒˆ'] },
    { name:'æŸ¿å®‰ãƒ€ã‚¤ãƒ‹ãƒ³ã‚°', floor:'1F', genre:'æƒ£èœ', element:'åœŸ', hours:{open:10,close:22}, emoji:'ğŸ¥˜', tags:['æƒ£èœ','ãŠå¼å½“','é«˜ç´š'] },
    // 2Fãƒ•ãƒ¼ãƒ‰ã‚³ãƒ¼ãƒˆ
    { name:'ä¸¸äº€è£½éºº', floor:'2F', genre:'ã†ã©ã‚“', element:'æ°´', hours:{open:10,close:22}, emoji:'ğŸœ', tags:['ã†ã©ã‚“','å¤©ã·ã‚‰','ã„ãªã‚Š'] },
    { name:'ãƒ‡ã‚£ãƒƒãƒ‘ãƒ¼ãƒ€ãƒ³', floor:'2F', genre:'ã‚¯ãƒ¬ãƒ¼ãƒ—', element:'æ°´', hours:{open:10,close:21}, emoji:'ğŸ“', tags:['ã‚¯ãƒ¬ãƒ¼ãƒ—','ã„ã¡ã”','ã‚¹ã‚¤ãƒ¼ãƒ„'] },
    { name:'é­åŠ›å±‹', floor:'2F', genre:'ãƒ©ãƒ¼ãƒ¡ãƒ³', element:'ç«', hours:{open:11,close:22}, emoji:'ğŸœ', tags:['ãƒ©ãƒ¼ãƒ¡ãƒ³','äº¬éƒ½','é†¤æ²¹'] },
    { name:'ã‚‚ãã¦ãã¡', floor:'2F', genre:'ãƒ©ãƒ¼ãƒ¡ãƒ³', element:'ç«', hours:{open:11,close:22}, emoji:'ğŸœ', tags:['è±šéª¨ãƒ©ãƒ¼ãƒ¡ãƒ³','ãƒ©ãƒ¼ãƒ¡ãƒ³'] },
    { name:'ã‚µãƒ–ã‚¦ã‚§ã‚¤', floor:'2F', genre:'ã‚µãƒ³ãƒ‰ã‚¤ãƒƒãƒ', element:'é¢¨', hours:{open:10,close:21}, emoji:'ğŸ¥–', tags:['ã‚µãƒ³ãƒ‰ã‚¤ãƒƒãƒ','ãƒ˜ãƒ«ã‚·ãƒ¼','è»½é£Ÿ'] },
    { name:'ã‚¹ã‚¿ãƒ¼ãƒãƒƒã‚¯ã‚¹ï¼ˆ2Fï¼‰', floor:'2F', genre:'ã‚«ãƒ•ã‚§', element:'é¢¨', hours:{open:9,close:22}, emoji:'â˜•', tags:['ã‚«ãƒ•ã‚§','ã‚¹ã‚¿ãƒ','ãƒ•ãƒ©ãƒšãƒãƒ¼ãƒ'] },
    { name:'ã‚¿ãƒªãƒ¼ã‚ºã‚³ãƒ¼ãƒ’ãƒ¼', floor:'2F', genre:'ã‚«ãƒ•ã‚§', element:'é¢¨', hours:{open:9,close:22}, emoji:'â˜•', tags:['ã‚«ãƒ•ã‚§','ã‚³ãƒ¼ãƒ’ãƒ¼'] },
    { name:'ã‚¹ã‚¿ãƒ¼ãƒãƒƒã‚¯ã‚¹ ãƒ†ã‚£ãƒ¼ï¼†ã‚«ãƒ•ã‚§', floor:'2F', genre:'ã‚«ãƒ•ã‚§ãƒ»ç´…èŒ¶', element:'é¢¨', hours:{open:10,close:22}, emoji:'ğŸ«–', tags:['ç´…èŒ¶','ãƒ†ã‚£ãƒ¼','ã‚¹ãƒ ãƒ¼ã‚¸ãƒ¼'] },
    { name:'ãã ã‚‚ã®ã‹ãµã‡', floor:'2F', genre:'ã‚«ãƒ•ã‚§ãƒ»ãƒ•ãƒ«ãƒ¼ãƒ„', element:'æ°´', hours:{open:10,close:21}, emoji:'ğŸ“', tags:['ã‚¹ãƒ ãƒ¼ã‚¸ãƒ¼','ãƒ•ãƒ«ãƒ¼ãƒ„','ã‚ã¾ãŠã†'] },
    { name:'ã‚´ãƒ‡ã‚£ãƒ', floor:'2F', genre:'ã‚¹ã‚¤ãƒ¼ãƒ„', element:'æ°´', hours:{open:10,close:21}, emoji:'ğŸ«', tags:['ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆ','é«˜ç´š','ã‚¹ã‚¤ãƒ¼ãƒ„'] },
    { name:'éŠ€ã ã“', floor:'2F', genre:'ãŸã“ç„¼ã', element:'ç«', hours:{open:10,close:21}, emoji:'ğŸ™', tags:['ãŸã“ç„¼ã','ã‚†ãšãƒãƒ³'] },
    { name:'ãƒ¢ã‚¹ãƒãƒ¼ã‚¬ãƒ¼', floor:'ãã®ä»–', genre:'ãƒ•ã‚¡ã‚¹ãƒˆãƒ•ãƒ¼ãƒ‰', element:'ç«', hours:{open:10,close:21}, emoji:'ğŸ”', tags:['ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼','é‡èœ'] },
];

// ========== ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ï¼ˆæ™ƒå¹³ã•ã‚“å°‚ç”¨ï¼‰ ==========
const userData = {
    name: 'å¤§æ‘æ™ƒå¹³',
    birthdate: '1993-04-14',
    zodiac: 'ç‰¡ç¾Šåº§',
    bloodType: 'B',
    eto: 'é…‰',
    element: 'ç«' // ç‰¡ç¾Šåº§ã¯ç«ã®ã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆ
};

// ========== å è¡“è¨ˆç®—ã‚¨ãƒ³ã‚¸ãƒ³ ==========

// æ˜Ÿåº§åˆ¥åŸºæœ¬é‹æ°—
const zodiacBase = {
    'ç‰¡ç¾Šåº§':{base:88,element:'ç«',planet:'ç«æ˜Ÿ',luckyNum:9},
    'ç‰¡ç‰›åº§':{base:82,element:'åœŸ',planet:'é‡‘æ˜Ÿ',luckyNum:6},
    'åŒå­åº§':{base:86,element:'é¢¨',planet:'æ°´æ˜Ÿ',luckyNum:5},
    'èŸ¹åº§':{base:80,element:'æ°´',planet:'æœˆ',luckyNum:2},
    'ç…å­åº§':{base:90,element:'ç«',planet:'å¤ªé™½',luckyNum:1},
    'ä¹™å¥³åº§':{base:84,element:'åœŸ',planet:'æ°´æ˜Ÿ',luckyNum:5},
    'å¤©ç§¤åº§':{base:85,element:'é¢¨',planet:'é‡‘æ˜Ÿ',luckyNum:6},
    'è åº§':{base:87,element:'æ°´',planet:'å†¥ç‹æ˜Ÿ',luckyNum:8},
    'å°„æ‰‹åº§':{base:89,element:'ç«',planet:'æœ¨æ˜Ÿ',luckyNum:3},
    'å±±ç¾Šåº§':{base:83,element:'åœŸ',planet:'åœŸæ˜Ÿ',luckyNum:8},
    'æ°´ç“¶åº§':{base:86,element:'é¢¨',planet:'å¤©ç‹æ˜Ÿ',luckyNum:4},
    'é­šåº§':{base:81,element:'æ°´',planet:'æµ·ç‹æ˜Ÿ',luckyNum:7}
};

// è¡€æ¶²å‹è£œæ­£
const bloodBonus = { 'A':3, 'B':5, 'O':4, 'AB':6 };

// å¹²æ”¯è£œæ­£
const etoBonus = { 'å­':4,'ä¸‘':3,'å¯…':6,'å¯':5,'è¾°':7,'å·³':4,'åˆ':6,'æœª':3,'ç”³':5,'é…‰':6,'æˆŒ':4,'äº¥':5 };

// æ›œæ—¥åˆ¥é‹æ°—
const dayBonus = [3,5,4,7,6,8,7]; // æ—¥æœˆç«æ°´æœ¨é‡‘åœŸ

// æ™‚é–“å¸¯åˆ¥é‹æ°—
function getHourScore(h) {
    const scores = [3,2,2,2,2,4,6,7,7,7,8,8,9,9,8,8,7,9,9,9,8,8,7,5];
    return scores[h] || 7;
}

// ä¹æ˜Ÿæ°—å­¦ï¼šæœ¬å‘½æ˜Ÿ
function getKyusei(birthYear) {
    const base = (birthYear - 1) % 9;
    const stars = ['ä¹ç´«ç«æ˜Ÿ','ä¸€ç™½æ°´æ˜Ÿ','äºŒé»’åœŸæ˜Ÿ','ä¸‰ç¢§æœ¨æ˜Ÿ','å››ç·‘æœ¨æ˜Ÿ','äº”é»„åœŸæ˜Ÿ','å…­ç™½é‡‘æ˜Ÿ','ä¸ƒèµ¤é‡‘æ˜Ÿ','å…«ç™½åœŸæ˜Ÿ'];
    return stars[base % 9];
}

// æ•°ç§˜è¡“ï¼šãƒ©ã‚¤ãƒ•ãƒ‘ã‚¹
function getLifePath(birthdate) {
    const digits = birthdate.replace(/-/g,'').split('').map(Number);
    let sum = digits.reduce((a,b)=>a+b,0);
    while (sum > 9 && sum !== 11 && sum !== 22) {
        sum = String(sum).split('').map(Number).reduce((a,b)=>a+b,0);
    }
    return sum;
}

// å››æŸ±æ¨å‘½ï¼šæ—¥å¹²
function getDayKan(now) {
    const base = new Date(2000,0,1);
    const diff = Math.floor((now - base) / 86400000);
    const kans = ['ç”²','ä¹™','ä¸™','ä¸','æˆŠ','å·±','åºš','è¾›','å£¬','ç™¸'];
    return kans[((diff % 10) + 10) % 10];
}

// å…­æ›œ
function getRokuyo(now) {
    const m = now.getMonth()+1, d = now.getDate();
    const idx = (m + d) % 6;
    return ['å¤§å®‰','èµ¤å£','å…ˆå‹','å‹å¼•','å…ˆè² ','ä»æ»…'][idx];
}

// æœˆç›¸è¨ˆç®—
function getMoonPhase(now) {
    const knownNew = new Date(2000, 0, 6);
    const diff = (now - knownNew) / 86400000;
    const cycle = diff % 29.53;
    if (cycle < 1.5 || cycle > 28) return { phase:'æ–°æœˆ', bonus:6 };
    if (cycle < 7.5) return { phase:'ä¸‰æ—¥æœˆ', bonus:4 };
    if (cycle < 9.5) return { phase:'ä¸Šå¼¦ã®æœˆ', bonus:5 };
    if (cycle < 14) return { phase:'åä¸‰å¤œ', bonus:6 };
    if (cycle < 16) return { phase:'æº€æœˆ', bonus:8 };
    if (cycle < 22) return { phase:'ä¸‹å¼¦ã®æœˆ', bonus:4 };
    return { phase:'æ™¦æ—¥æœˆ', bonus:3 };
}

// ã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆç›¸æ€§
function getElementCompatibility(userElement, shopElement) {
    const compat = {
        'ç«': { 'ç«':10, 'åœŸ':8, 'é¢¨':9, 'æ°´':5 },
        'åœŸ': { 'ç«':8, 'åœŸ':10, 'é¢¨':6, 'æ°´':7 },
        'é¢¨': { 'ç«':9, 'åœŸ':6, 'é¢¨':10, 'æ°´':8 },
        'æ°´': { 'ç«':5, 'åœŸ':7, 'é¢¨':8, 'æ°´':10 }
    };
    return compat[userElement][shopElement] || 7;
}

// ========== ãƒ¡ã‚¤ãƒ³è¨ˆç®—é–¢æ•° ==========
function calculateRestaurantScores(now) {
    const h = now.getHours();
    const zData = zodiacBase[userData.zodiac];
    
    // åŸºæœ¬é‹æ°—
    let baseScore = zData.base;
    baseScore += bloodBonus[userData.bloodType];
    baseScore += etoBonus[userData.eto];
    baseScore += dayBonus[now.getDay()];
    
    // æ•°ç§˜è¡“ãƒ»æœˆç›¸
    const lp = getLifePath(userData.birthdate);
    const moonPhase = getMoonPhase(now);
    baseScore += (lp % 5) + moonPhase.bonus;
    
    // å…­æ›œ
    const rokuyo = getRokuyo(now);
    const rokuyoBonus = {'å¤§å®‰':8,'å‹å¼•':5,'å…ˆå‹':4,'å…ˆè² ':3,'èµ¤å£':2,'ä»æ»…':1};
    baseScore += (rokuyoBonus[rokuyo] || 4);
    
    // å„åº—èˆ—ã®ã‚¹ã‚³ã‚¢è¨ˆç®—
    return restaurants.map(shop => {
        let score = baseScore;
        
        // å–¶æ¥­æ™‚é–“ãƒã‚§ãƒƒã‚¯
        const isOpen = h >= shop.hours.open && h < shop.hours.close;
        if (!isOpen) score -= 50; // å–¶æ¥­æ™‚é–“å¤–ã¯å¤§å¹…æ¸›ç‚¹
        
        // ã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆç›¸æ€§
        score += getElementCompatibility(userData.element, shop.element);
        
        // æ™‚é–“å¸¯ã‚¹ã‚³ã‚¢
        score += getHourScore(h);
        
        // ã‚¸ãƒ£ãƒ³ãƒ«åˆ¥è£œæ­£ï¼ˆæ™‚é–“å¸¯ã«ã‚ˆã‚‹ï¼‰
        if (h >= 7 && h < 11) { // æœé£Ÿ
            if (shop.genre.includes('ã‚«ãƒ•ã‚§')) score += 10;
            if (shop.name.includes('ã‚³ãƒ¡ãƒ€')) score += 5;
        } else if (h >= 11 && h < 15) { // æ˜¼é£Ÿ
            if (shop.genre.includes('ã†ã©ã‚“') || shop.genre.includes('å®šé£Ÿ') || shop.genre.includes('æµ·é®®')) score += 10;
            if (shop.name.includes('ä¸¸äº€') || shop.name.includes('æºã¡ã‚ƒã‚“')) score += 5;
        } else if (h >= 15 && h < 18) { // ãŠã‚„ã¤
            if (shop.genre.includes('ã‚¹ã‚¤ãƒ¼ãƒ„') || shop.genre.includes('ã‚¯ãƒ¬ãƒ¼ãƒ—') || shop.genre.includes('ã‚«ãƒ•ã‚§')) score += 10;
            if (shop.name.includes('ãƒ‡ã‚£ãƒƒãƒ‘ãƒ¼ãƒ€ãƒ³')) score += 5;
        } else if (h >= 18 && h < 22) { // å¤•é£Ÿ
            if (shop.genre.includes('ãƒ©ãƒ¼ãƒ¡ãƒ³') || shop.genre.includes('ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³')) score += 10;
        } else { // æ·±å¤œãƒ»æ—©æœ
            if (shop.name.includes('ãƒã‚¯ãƒ‰ãƒŠãƒ«ãƒ‰')) score += 15;
        }
        
        // ãƒ©ãƒ³ãƒ€ãƒ è¦ç´ ï¼ˆæ—¥ä»˜ãƒ™ãƒ¼ã‚¹ï¼‰
        const seed = now.getDate() * 7 + h;
        score += (seed % 11) - 5;
        
        return {
            ...shop,
            score: Math.min(99, Math.max(60, Math.round(score))),
            isOpen
        };
    }).sort((a,b) => b.score - a.score);
}

// ç†ç”±ç”Ÿæˆ
function generateReason(shop, rank, now) {
    const reasons = [];
    const h = now.getHours();
    const rokuyo = getRokuyo(now);
    const moonPhase = getMoonPhase(now);
    
    // ã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆ
    const elementMsg = {
        'ç«':'ç«ã®ã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆåŒå£«ã§é‹æ°—ãŒå…±é³´ã—ã¾ã™',
        'åœŸ':'åœŸã®ã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆãŒå®‰å®šæ„Ÿã‚’ã‚‚ãŸã‚‰ã—ã¾ã™',
        'é¢¨':'é¢¨ã®ã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆãŒè»½ã‚„ã‹ãªé‹æ°—ã‚’é‹ã³ã¾ã™',
        'æ°´':'æ°´ã®ã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆãŒæµ„åŒ–ã¨ç™’ã—ã‚’ã‚‚ãŸã‚‰ã—ã¾ã™'
    };
    reasons.push(elementMsg[shop.element]);
    
    // æ™‚é–“å¸¯
    if (h >= 7 && h < 11) reasons.push('æœã®é‹æ°—ãŒé«˜ã¾ã‚‹æ™‚é–“å¸¯ã§ã™');
    else if (h >= 11 && h < 15) reasons.push('ãƒ©ãƒ³ãƒã‚¿ã‚¤ãƒ ã®é»„é‡‘æ™‚é–“å¸¯ã§ã™');
    else if (h >= 15 && h < 18) reasons.push('åˆå¾Œã®ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã«æœ€é©ã§ã™');
    else if (h >= 18 && h < 22) reasons.push('å¤•é£Ÿã®é‹æ°—ãŒçµ¶é ‚ã§ã™');
    
    // å…­æ›œ
    if (rokuyo === 'å¤§å®‰') reasons.push('å¤§å®‰ã®å‰æ—¥ãƒ‘ãƒ¯ãƒ¼');
    else if (rokuyo === 'å‹å¼•') reasons.push('å‹å¼•ã§è‰¯ç¸ã‚’å¼•ãå¯„ã›ã¾ã™');
    
    // æœˆç›¸
    if (moonPhase.phase === 'æº€æœˆ' || moonPhase.phase === 'æ–°æœˆ') {
        reasons.push(`${moonPhase.phase}ã®å¼·åŠ›ãªã‚¨ãƒãƒ«ã‚®ãƒ¼`);
    }
    
    // ãƒ©ãƒ³ã‚¯åˆ¥
    if (rank === 1) reasons.push('ä»Šæ—¥ã®ã‚ãªãŸã«æœ€ã‚‚ç›¸æ€§ãŒè‰¯ã„åº—ã§ã™');
    
    return reasons.join('ã€‚') + 'ã€‚';
}

// ========== UIæ›´æ–° ==========
function updateTime() {
    const now = new Date();
    const m = now.getMonth()+1, d = now.getDate();
    const h = String(now.getHours()).padStart(2,'0');
    const min = String(now.getMinutes()).padStart(2,'0');
    const days = ['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'];
    document.getElementById('current-time').textContent = `${m}/${d}(${days[now.getDay()]}) ${h}:${min}`;
}
updateTime();
setInterval(updateTime, 1000);

// ========== å ã„å®Ÿè¡Œ ==========
function startFortune() {
    document.getElementById('loading').classList.add('show');
    document.getElementById('result').classList.remove('show');
    
    setTimeout(() => {
        const now = new Date();
        const ranked = calculateRestaurantScores(now);
        const top3 = ranked.slice(0, 3);
        
        let html = '';
        top3.forEach((shop, i) => {
            const medals = ['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'];
            html += `
            <div class="result-card">
                <div class="shop-header">
                    <div class="rank">${medals[i]}</div>
                    <div class="shop-icon">${shop.emoji}</div>
                    <div class="shop-info">
                        <div class="shop-name">${shop.name}</div>
                        <div class="shop-location">${shop.floor} ${shop.genre}</div>
                    </div>
                </div>
                <div class="score-badge">é‹æ°—ã‚¹ã‚³ã‚¢ï¼š${shop.score}ç‚¹</div>
                <div class="reason">${generateReason(shop, i+1, now)}</div>
                <div class="tags">
                    ${shop.tags.map(t => `<span class="tag">#${t}</span>`).join('')}
                </div>
            </div>`;
        });
        
        // ã‚µãƒãƒªãƒ¼è¿½åŠ 
        const rokuyo = getRokuyo(now);
        const moonPhase = getMoonPhase(now);
        html += `
        <div class="summary">
            <div class="summary-title">ä»Šæ—¥ã®ç·åˆé‹</div>
            <div class="summary-text">
                ${rokuyo}ã®${moonPhase.phase}ã€‚${userData.zodiac}ã®ã‚ãªãŸã¯${userData.element}ã®ã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆã€‚
                ä»Šæ—¥ã¯${top3[0].name}ã¨ã®ç›¸æ€§ãŒæœ€é«˜ã§ã™ï¼ç´ æ•µãªé£Ÿäº‹ã®æ™‚é–“ã‚’âœ¨
            </div>
        </div>
        <button class="back-btn" onclick="location.reload()">ã‚‚ã†ä¸€åº¦å ã†</button>`;
        
        document.getElementById('result').innerHTML = html;
        document.getElementById('loading').classList.remove('show');
        document.getElementById('result').classList.add('show');
    }, 1800);
}
</script>
</body>
</html>